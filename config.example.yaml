# =============================================================================
# Celery Doorman - Configuration File
# =============================================================================
# Copy this file as config.yaml and adjust according to your environment.

# -----------------------------------------------------------------------------
# Connections
# -----------------------------------------------------------------------------
redis_url: "redis://redis:6379/0"
celery_broker_url: "redis://redis:6379/0"
celery_app_name: "tasks"

# -----------------------------------------------------------------------------
# Alert Webhooks
# Configure at least one to receive notifications
# -----------------------------------------------------------------------------
slack_webhook_url: null  # https://hooks.slack.com/services/XXX/YYY/ZZZ
pagerduty_routing_key: null  # Your PagerDuty Events API v2 routing key
generic_webhook_url: null  # Any endpoint that accepts JSON POST

# -----------------------------------------------------------------------------
# Behavior
# -----------------------------------------------------------------------------
check_interval_seconds: 30  # How often to check (recommended: 30-60)
alert_cooldown_seconds: 300  # Don't repeat same alert for 5 minutes
auto_kill_zombie_tasks: false  # ⚠️ Dangerous: automatically kill stuck tasks

# -----------------------------------------------------------------------------
# Queues to Monitor
# List of Celery queue names in Redis
# -----------------------------------------------------------------------------
monitored_queues:
  - celery  # Celery default queue
  - default
  - priority
  - emails
  - payments
  - notifications

# -----------------------------------------------------------------------------
# Alert Thresholds
# Adjust according to your system's normal behavior
# -----------------------------------------------------------------------------
thresholds:
  # Maximum pending tasks before alerting
  max_queue_size: 1000
  
  # Maximum time (seconds) a task can wait in queue
  # This is the most important metric for the business
  max_wait_time_seconds: 60
  
  # Maximum time (seconds) a task can be running
  # Tasks exceeding this are marked as "zombies"
  max_task_runtime_seconds: 1800  # 30 minutes
  
  # Maximum time without heartbeat from a worker
  worker_heartbeat_timeout_seconds: 120
  
  # Critical queues that receive higher severity alerts
  critical_queues:
    - payments
    - emails
    - notifications
